# Инструкции по chatai

## Получение ключа для API gemini
Чтобы бот начал работать нужно получить ключ для API gemini

1. Идём на `https://aistudio.google.com` и регистрируемся
2. Внизу (слева) в вертикальном меню жмём - `Get API key`
3. Копируем полученный ключ, чтобы использовать в боте.

Так же можно почитать **Краткое руководство по API Gemini** - `https://ai.google.dev/gemini-api/docs/quickstart?lang=python&hl=ru`

## Необходимый минимум дя работы бота

1. Установить все зависимости, используя файл `requirements.txt`
2. Переименовать файл `.env_template` в `.env`. Заполнить переменные в файле требуемыми значениями!
3. Из-за того, что используется `dotenv`, `GEMINI_API_KEY` загружается в переменные окружения и её не надо явно указывать при вызове `client = genai.Client()`

## Архитектура и ключевые компоненты
- Проект — Telegram-бот с интеграцией внешних AI (Gemini) и поддержкой длинных сообщений.
- Главный файл запуска: `main.py`.
- Ключевые директории:
  - `api/`: интеграция с внешними AI (`gemini.py`).
  - `config_data/`: конфигурация, параметры запуска (`config.py`).
  - `handlers/`: обработчики Telegram-команд (`handlers_custom/`, `handlers_default/`).
  - `services/`: сервисные функции для работы с текстом (`text_cleaner.py`, `text_splitter.py`, `block_splitter.py`).

## Критические паттерны и конвенции
- Для отправки длинных сообщений используется разбиение текста на части с лимитом ~3900 символов (см. `services/block_splitter.py`, `services/text_splitter.py`).
- Для передачи очень длинных текстов используйте отправку файла через `send_document` (пример: `test1.py`).
- Всегда оборачивайте вызовы Telegram API (`send_message`, `send_document`) в `try-except` для предотвращения падения бота.
- Все обработчики команд оформляйте через декоратор `@bot.message_handler` (`handlers_default/start.py`, `handlers_default/help.py`).
- Сервисные функции для работы с текстом вынесены в отдельные модули в `services/`.

## Взаимодействие компонентов
- Обработчики команд используют сервисы для подготовки текста и API-модули для обращения к внешним AI.
- Конфигурация токенов и параметров — в `config_data/config.py` и `.env_template`.

## Запуск, тестирование и отладка
- Запуск бота: `python main.py`
- Все зависимости — в `requirements.txt`
- Для отладки используйте вывод ошибок в консоль и обработку исключений

## Примеры специфических решений
- Разделение длинных сообщений по параграфам и коду для сохранения структуры (`block_splitter.py`, `text_splitter.py`).
- Задержка между отправкой частей сообщения для обхода лимитов Telegram (`time.sleep(0.5)`).
- Отправка очень длинных текстов через файл (`send_document`).

## Внешние зависимости
- Основная библиотека для Telegram: `pyTelegramBotAPI` (telebot)
- Для интеграции с AI используйте соответствующие API-клиенты (`google-genai`, `requests`)

## Рекомендации для AI-агентов
- Новые обработчики команд размещайте в соответствующих подпапках `handlers/`
- Для работы с длинным текстом используйте сервисы из `services/`
- Следуйте структуре и паттернам, описанным в коде проекта
